## 알림 시스템 설계

알림 시스템은 사용자의 관심을 끌고 중요한 정보를 전달하기 위한 핵심 기능입니다. 예를 들어, 넷플릭스의 신작 알림, 쇼핑몰의 배송 상태 업데이트, 게임의 친구 요청 등은 모두 이 시스템을 통해 작동합니다. 본 설계에서는 모바일 푸시 알림(iOS, Android), SMS, 이메일 등 다양한 채널을 통합적으로 관리할 수 있는 대규모 알림 시스템을 설계합니다.

## 2. 요구사항 정의 및 질의 전략

시스템 설계 면접에서는 요구사항이 불명확한 경우가 많아, 아래와 같은 질문을 통해 범위를 좁히는 것이 중요합니다.

- 지원해야 하는 알림 채널은?
→ 푸시 알림, SMS, 이메일
- 실시간 시스템인가?
→ 연성 실시간(최대한 빠르게, 다만 지연 가능)
- 대상 단말 기종은?
→ iOS, Android, Web
- 알림 생성 주체는?
→ 클라이언트 앱 또는 서버 스케줄러
- 사용자 옵트아웃(opt-out) 기능 필요?
→ 설정한 사용자는 알림 수신 불가
- 일일 최대 처리량은?
→ 푸시 1천만 건, SMS 100만 건, 이메일 500만 건

## 3. 채널별 전송 메커니즘

### 3.1 iOS (APNS)

- **필요 요소:** 단말 토큰, 페이로드(JSON), 인증 키
- **전송 흐름:** 서버 → APNS → iOS 디바이스
- **페이로드 예시:**

```
{
  "aps": {
    "alert": {
      "title": "Game Request",
      "body": "Bob wants to play chess"
    },
    "badge": 5
  }
}
```

### 3.2 Android (FCM)

- APNS와 유사하지만 FCM 서버를 사용
- 하나의 플랫폼에서 다양한 메시지 유형 지원 가능

### 3.3 SMS

- 상용 서비스(Twilio, Nexmo 등) 사용
- 전화번호 기반이며 메시지 요금 부과됨

### 3.4 이메일

- SMTP 또는 상용 API(SendGrid, Mailchimp 등)
- HTML 형식 지원, 전송 성공률과 통계 분석 기능 제공

## 4. 시스템 구성안

### 4.1 초안 설계

- 하나의 서버에서 모든 요청 처리 → **SPOF 발생**
- DB/캐시 통합, 단일 프로세스 병목

### 4.2 개선안 설계

- 알림 서버: API 수신, 검증, 큐 전송
- 메시지 큐: 이벤트 종류별 큐 분리(iOS 큐, SMS 큐 등)
- 작업 서버: 큐에서 메시지를 가져와 실제 전송
- DB/캐시: 사용자 정보, 알림 템플릿, 설정 저장
- 확장 포인트: 서버 수평 확장, FCM/APNS 장애 대응

## 5. 상세 설계 요소

### 5.1 데이터 무결성과 재시도

- DB에 알림 로그 저장
- 메시지 전송 실패 시 재시도 큐로 분기
- 최대 N회 실패 시 관리자 알림

### 5.2 중복 방지

- 이벤트 ID 기반 중복 검사 로직 추가

### 5.3 사용자 알림 설정 (Opt-In/Out)

- 사용자 ID, 채널, 수신 여부를 설정 테이블로 관리
- 각 전송 전 필터링

### 5.4 템플릿 관리

- "[상품명]이 입고되었습니다! [날짜]까지 주문 가능"처럼 파라미터 기반 구성
- 일관성 확보 및 개발 속도 개선

### 5.5 인증 및 보안

- 알림 API에 appKey/appSecret 인증 적용
- 승인된 서비스만 요청 가능

### 5.6 처리율 제한

- 사용자당 알림 전송 빈도 제한 (예: 시간당 3건)

### 5.7 큐 모니터링 및 시스템 메트릭

- 큐 길이, 실패율, 처리 지연 시간 등 모니터링
- 대기열 증가 시 작업 서버 자동 확장

### 5.8 이벤트 추적 통합

- 알림 전송 성공/실패, 확인 여부, 클릭률 등
- 통합 분석 도구와 연동 (예: Amplitude, GA)

## 6. 최종 설계 요약

| 컴포넌트 | 역할 |
| --- | --- |
| 알림 서버 | 요청 수신, 검증, 이벤트 생성 |
| 캐시/DB | 사용자/단말 정보, 알림 설정, 템플릿 저장 |
| 메시지 큐 | 비동기 이벤트 전파, 재시도 큐 포함 |
| 작업 서버 | 큐 소비, 제3자 전송 API 호출 |
| 인증 모듈 | API 호출 권한 검증 |
| 모니터링 | 대시보드, 이벤트 추적, 경보 시스템 |

## 7. 결론

알림 시스템은 단순한 전송 기능을 넘어 사용자 경험에 깊은 영향을 미칩니다. 대량 처리, 다양한 채널, 사용자 제어, 높은 안정성과 확장성까지 고려한 설계가 필요합니다. 본 설계는 메시지 큐를 중심으로 느슨한 결합을 유지하며, 장애에 강하고 유연하게 확장 가능한 구조를 제안합니다.